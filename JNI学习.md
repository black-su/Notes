# JNI学习

1. JNI环境安装

IDE：android studio
下载NDK：android studio的设置 -> Android SDK -> SDK Tool -> NDK下载


jdk提供了一个工具用于生成jni的.h头文件，不需要我们取手写jni的.h头文件。但是这个工具不同的版本有不同的用法。

早期版本的这个工具的用法：
```
//需要先cd到当前class文件的目录下
javap MyClass.class
```

但是在我机器中，javap的指令只是在cmd中打印了一些class信息，并无jni的.h头文件生成。目前的jdk版本如下：
```
openjdk version "1.8.0_292"
OpenJDK Runtime Environment (build 1.8.0_292-8u292-b10-0ubuntu1~20.04-b10)
OpenJDK 64-Bit Server VM (build 25.292-b10, mixed mode)
```
openjdk 1.8版本的javap指令应该是有改动，按照以下的格式，可以把java文件编译成class文件，并生成相应的jni头文件，前提是java文件中需要有native本地方法的定义。
```
//需要先cd到当前java文件的目录下
javac -h . MyClass.java
```

java文件：
```
public class MyClass {
    public static void main(String args[]){
        System.out.println("ppppppp");
    }
    public static native String helloJni();
    public static native int addCalc(int a, int b);
}
```

生成的jni头文件，默认以包名作为名称前缀：com_example_java_lib_MyClass.h
```
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class com_example_java_lib_MyClass */

#ifndef _Included_com_example_java_lib_MyClass
#define _Included_com_example_java_lib_MyClass
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     com_example_java_lib_MyClass
 * Method:    helloJni
 * Signature: ()Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_com_example_java_1lib_MyClass_helloJni
  (JNIEnv *, jclass);

/*
 * Class:     com_example_java_lib_MyClass
 * Method:    addCalc
 * Signature: (II)I
 */
JNIEXPORT jint JNICALL Java_com_example_java_1lib_MyClass_addCalc
  (JNIEnv *, jclass, jint, jint);

#ifdef __cplusplus
}
#endif
#endif
```

2. JNI语法